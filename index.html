<DOCTYPE html>
<html>
    <head>
        <title>Voting</title>
        <script src="https://code.jquery.com/jquery.min.js"></script>
    </head>
    <body>
        <strong><big>2018 이천고 학생회장 모의선거</big></strong> <br />
        ______축구(sc)  1st: <Input type="number" id="sc1"> 2nd: <Input type="number" id="sc2">  <br>
        <button id="check" onclick="check_click();" type="button">Check</button><br />

        <script>
            const Web3 = require('web3')
            const Tx = require('ethereumjs-tx')
            const web3 = new Web3(new Web3.providers.HttpProvider('https://mainnet.infura.io/INFURA_KEY'))
            const addressFrom = '0x3e62Ffa65462F1a76E3f8c3D4F90F319570af5fD'
            const privKey = 'PRIVATE_KEY'
            const addressTo = '0x1463500476a3ADDa33ef1dF530063fE126203186'
            function sendSigned(txData, cb) {
              const privateKey = new Buffer(config.privKey, 'hex')
              const transaction = new Tx(txData)
              transaction.sign(privateKey)
              const serializedTx = transaction.serialize().toString('hex')
              web3.eth.sendSignedTransaction('0x' + serializedTx, cb)
            }
            // get the number of transactions sent so far so we can create a fresh nonce
            web3.eth.getTransactionCount(addressFrom).then(txCount => {
              // construct the transaction data
              const txData = {
                nonce: web3.utils.toHex(txCount),
                gasLimit: web3.utils.toHex(25000),
                gasPrice: web3.utils.toHex(11e9), // 11 Gwei
                to: addressTo,
                from: addressFrom,
                value: web3.utils.toHex(web3.utils.toWei(123, 'wei'))
              }
              sendSigned(txData, function(err, result) {
                if (err) return console.log('error', err)
                console.log('sent', result)
              })
            })




            var contract

            function send_click() {
                transfer();
            }

            function check_click() {
                check();
            }

            $.getJSON('Olympic.json', function (abi) {
                contract = window.web3.eth.contract(abi).at('0x6d4ad896a842835cc2ef34010942aa54f7f553be')
            })

            function transfer() {
                var sc1 = document.getElementById("sc1").value;
                contract.predict.sendTransaction(sc1, sc2, jg1, jg2, tpr1, tpr2, er1, er2, tr1, tr2, { from: web3.eth.accounts[0], gas: 4000000 }, function (error, result) {
                    if (!error) { console.log(result); } else { console.log(error); }
                })
            }

            function check() {
                var add = document.getElementById("address").value;
                var sc1, sc2, jg1, jg2, tpr1, tpr2, er1, er2, tr1, tr2;
                /*
                contract.get(add, function (error, result) {
                    // The result contains various info
                    // which includes the arguments given
                    // to the deposit call.
                    if (!error)
                        console.log(result);
                })*/

                contract.get_sc1(add, function (error, result) {
                    if (!error) { console.log(result); document.getElementById("res1").value = result;} else { console.log(error); }
                })
                contract.get_sc2(add, function (error, result) {
                    if (!error) { console.log(result); document.getElementById("res2").value = result;} else { console.log(error); }
                })
                contract.get_jg1(add, function (error, result) {
                    if (!error) { console.log(result); document.getElementById("res3").value = result;} else { console.log(error); }
                })
                contract.get_jg2(add, function (error, result) {
                    if (!error) { console.log(result); document.getElementById("res4").value = result;} else { console.log(error); }
                })
                contract.get_tpr1(add, function (error, result) {
                    if (!error) { console.log(result); document.getElementById("res5").value = result;} else { console.log(error); }
                })
                contract.get_tpr2(add, function (error, result) {
                    if (!error) { console.log(result); document.getElementById("res6").value = result; } else { console.log(error); }
                })
                contract.get_er1(add, function (error, result) {
                    if (!error) { console.log(result); document.getElementById("res7").value = result;} else { console.log(error); }
                })
                contract.get_er2(add, function (error, result) {
                    if (!error) { console.log(result); document.getElementById("res8").value = result; } else { console.log(error); }
                })
                contract.get_tr1(add, function (error, result) {
                    if (!error) { console.log(result); document.getElementById("res9").value = result; } else { console.log(error); }
                })
                contract.get_tr2(add, function (error, result) {
                    if (!error) { console.log(result); document.getElementById("res10").value = result; } else { console.log(error); }
                })
            }
        </script>
    </body>
</html>
